---
timestamp: 'Mon Dec 01 2025 21:08:22 GMT-0500 (Eastern Standard Time)'
content_id: 8cb4df52ff9f2c07c113a2547bbdc59cb175fd8cb94279e152d4151a3b4411ea
---

# file: src/concepts/Profile/ProfileConcept.ts

```typescript
import { Collection, Db } from "npm:mongodb";
import { Empty, ID } from "@utils/types.ts";

const PREFIX = "Profile" + ".";

// Generic types for the concept's external dependencies
type User = ID;

/**
 * State:
 * a set of UserProfiles with
 *  a bio string
 *  an thumbnailUrl string
 */
interface UserProfileDoc {
  _id: User;
  bio?: string; 
  thumbnailUrl?: string;
}

/**
 * @concept Profile
 * @purpose To store and manage public biographical information and a profile image for users.
 *
 * @principle If a user sets their bio and profile picture, then other users can view these details
 *            on their profile page, allowing for personal expression and recognition.
 */
export default class ProfileConcept {
  userProfiles: Collection<UserProfileDoc>;

  constructor(private readonly db: Db) {
    this.userProfiles = this.db.collection(PREFIX + "userProfiles");
  }

  // Removed addBio action, as updateBio handles creation and modification

  /**
   * Action: Updates a user's biographical information.
   * If the user's profile document does not exist, it will be created (upsert).
   *
   * @param {object} params - The parameters for the operation.
   * @param {User} params.user - The ID of the user whose bio is being updated.
   * @param {string} params.bio - The new biographical string for the user.
   * @returns {Promise<Empty | { error: string }>} An empty object on success, or an error object if the operation fails.
   * @requires N/A (always allowed)
   * @effects Sets or updates the `bio` field for the specified `user`'s profile.
   *          A new profile document is created if one does not already exist for the user.
   */
  async updateBio({
    user,
    bio,
  }: {
    user: User;
    bio: string;
  }): Promise<Empty | { error: string }> {
    try {
      await this.userProfiles.updateOne(
        { _id: user },
        { $set: { bio } },
        { upsert: true } 
      );
      return {};
    } catch (e) {
      console.error(`Error updating bio for user ${user}:`, e);
      return { error: "Failed to update user bio." };
    }
  }

  // Removed addThumbnail action, as updateThumbnail handles creation and modification

  /**
   * Action: Updates a user's profile thumbnail URL.
   * If the user's profile document does not exist, it will be created (upsert).
   *
   * @param {object} params - The parameters for the operation.
   * @param {User} params.user - The ID of the user whose thumbnail is being updated.
   * @param {string} params.thumbnailUrl - The new URL for the profile thumbnail.
   * @returns {Promise<Empty | { error: string }>} An empty object on success, or an error object if the operation fails.
   * @requires N/A (always allowed)
   * @effects Sets or updates the `thumbnailUrl` field for the specified `user`'s profile.
   *          A new profile document is created if one does not already exist for the user.
   */
  async updateThumbnail({
    user,
    thumbnailUrl,
  }: {
    user: User;
    thumbnailUrl: string;
  }): Promise<Empty | { error: string }> {
    try {
      await this.userProfiles.updateOne(
        { _id: user },
        { $set: { thumbnailUrl } },
        { upsert: true } // Crucial: Create document if it doesn't exist
      );
      return {};
    } catch (e) {
      console.error(`Error updating thumbnail for user ${user}:`, e);
      return { error: "Failed to update user thumbnail." };
    }
  }

  /**
   * Query: Retrieves a user's biographical information.
   *
   * @param {object} params - The parameters for the operation.
   * @param {User} params.user - The ID of the user.
   * @returns {Promise<Array<{ bio: string }>>} An array containing one object `{ bio: string }` if a bio is found, otherwise an empty array.
   * @requires N/A
   * @effects Returns the `bio` of the user if it exists.
   */
  async _getBio({ user }: { user: User }): Promise<Array<{ bio: string }>> {
    const profile = await this.userProfiles.findOne(
      { _id: user },
      { projection: { bio: 1, _id: 0 } }
    );
    // Return bio string in an array if found, otherwise an empty array
    return profile?.bio ? [{ bio: profile.bio }] : [];
  }

  /**
   * Query: Retrieves a user's profile thumbnail URL.
   *
   * @param {object} params - The parameters for the operation.
   * @param {User} params.user - The ID of the user.
   * @returns {Promise<Array<{ thumbnailUrl: string }>>} An array containing one object `{ thumbnailUrl: string }` if a thumbnail URL is found, otherwise an empty array.
   * @requires N/A
   * @effects Returns the `thumbnailUrl` of the user if it exists.
   */
  async _getThumbnail({
    user,
  }: {
    user: User;
  }): Promise<Array<{ thumbnailUrl: string }>> {
    const profile = await this.userProfiles.findOne(
      { _id: user },
      { projection: { thumbnailUrl: 1, _id: 0 } }
    );
    // Return thumbnailUrl string in an array if found, otherwise an empty array
    return profile?.thumbnailUrl
      ? [{ thumbnailUrl: profile.thumbnailUrl }]
      : [];
  }

  /**
   * Query: Retrieves a user's complete profile (bio and thumbnail URL).
   *
   * @param {object} params - The parameters for the operation.
   * @param {User} params.user - The ID of the user.
   * @returns {Promise<Array<{ profile: { bio?: string; thumbnailUrl?: string } }>>} An array containing one object `{ profile: { bio?: string; thumbnailUrl?: string } }` if a profile document exists. The `bio` and `thumbnailUrl` fields within the `profile` object will be present only if they are set for the user. Returns an empty array if no profile document is found.
   * @requires N/A
   * @effects Returns the bio and thumbnail URL for the user, with fields being optional if not set.
   */
  async _getProfile({
    user,
  }: {
    user: User;
  }): Promise<Array<{ profile: { bio?: string; thumbnailUrl?: string } }>> {
    const profile = await this.userProfiles.findOne(
      { _id: user },
      { projection: { bio: 1, thumbnailUrl: 1, _id: 0 } }
    );
    // If the profile document is found, return an array with one object.
    // Fields bio/thumbnailUrl will be undefined if not present in the document.
    return profile
      ? [{ profile: { bio: profile.bio, thumbnailUrl: profile.thumbnailUrl } }]
      : [];
  }
}

```
